<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
      <title> New Document </title>
      <meta charset="UTF-8">
      <meta name="Generator" content="EditPlus">
      <meta name="Author" content="">
      <meta name="Keywords" content="">
      <meta name="Description" content="">
      <link rel="stylesheet" type="text/css" href="">
      <style type="text/css">
        body{position:relative;}
        .divIn{width:500px;height:300px;background:white;}
        .divOut{position:absolute;top:0px;bottom:0px;width:500px;height:352px;}
        .divProduct{position: absolute; top:10px; width:80px;height:30px;background:red; display:none;}
        .bg{width:100%;height:100%;
        /**透明层兼容**/
        filter:alpha(opacity=0);-moz-opacity:0;-khtml-opacity: 0;opacity: 0;
        background-color:black;z-index:0;position:absolute;}
        .nr{border:1px solid red;width:500px;height:300px;margin:100px auto 0px;background:#fff;z-index:1000;position:relative;}
        .nr div{position:absolute;}

        #box2{}
        #box2 div{display:block; padding:2px; border:0;}
        #box2 a{color:#333; text-decoration:none;border:2px solid #FFF; float:left; cursor:hand;}
        #box2 a span{display:none; color:#F00;}
        #box2 a span h1{font-size:12px; position:absolute; bottom:0; background:#333; color:#FFF; font-weight:normal; text-align:center; width:320px; padding:4px; display:block;
        filter:alpha(opacity=60);
        -moz-opacity:0.60;
        opacity:0.60; top:80px; height:30px;
        }
        #box2 a:hover{color:#999; border:2px solid #333; }
        #box2 a:hover span{display:inline; position:absolute;}

    </style>
        <link href="/static/js/node_modules/video.js/dist/video-js/video-js.css" rel="stylesheet">
    <script src="/static/js/node_modules/video.js/dist/video-js/video.js"></script>
    <link href="/static/css/videojs.thumbnails.css" rel="stylesheet">
    <script src='/static/js/videojs.thumbnails.js'></script>
    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <script type="text/javascript">
        /* add video control */
        var player;
		$(document).ready(function() {

{#            var s = document.createElement("script");#}
{#            var video = document.createElement("");#}
            var isPlaying = false;
            player = videojs("my-video");
            player.on(['waiting', 'pause'], function() {
                isPlaying = false;
            });

             player.on('playing', function() {
                isPlaying = true;
            });
            $('#overlayer').click(function play() {
                //var video = videojs("my-video");
                if (!isPlaying) {
                    player.play();
                    document.getElementById('productLayer').style.display = 'None';
                }else {
                    player.pause();
                    callAjaxWhenPaused();
                }
            });

            $('#overlayer').mouseover(function play() {
                if (isPlaying) {
                    player.pause();
                    callAjaxWhenPaused();
                }
            });


            function callAjaxWhenPaused(){
                /* get url parameter */
                var url = window.location.href
                var video_id = url.charAt(url.length-2);
                $.ajax({
                    type : "POST",
                    url : "/check_product_info/",
                    data : {"videoId" : video_id, "time": player.currentTime()},
                    cache: false,
                    dataType: "json",
                    success: function(response_data, statues, xml){
                        if(response_data['result']=='success') {
                            document.getElementById('productLayer').style.display = 'block';
                            var product_buy_url = response_data['product_buy_url'];
                            var product_name = response_data['product_name'];
                            var product_image =response_data['product_image_path'];
                            var a_element = document.getElementById('productLayerA');
                            a_element.href = product_buy_url;
                            a_element.text = product_name;
                            var image_element = document.getElementById('productLayerImage');
                            if (product_image.length > 0) {
                                image_element.src = product_image;
                            }

                            return false;
                        }else{
                            document.getElementById('error1').innerHTML = player.currentTime();
                            ocument.getElementById('productLayer').style.display = 'none';
                        }

                    },
                    error: function(){
                        alert("request failed");
                    }
                 });

            }

        });
    </script>
 </head>

 <body width = "500" height="410">
      <div class="divIn">
          <video id="my-video" width="500" height="400" class='video-js vjs-default-skin' controls>
            <source src= {{video.video_path}} type="video/mp4">
            Your browser does not support HTML5 video.
          </video>

      </div>    <!--body里的内容-->

      <div class="divOut" id="overlayer">
     </div>
        <div class="divProduct" id="productLayer">
            <a herf ="" id = 'productLayerA'>testing</a>
            <img id = 'productLayerImage' src="" width="60px" height="60px">
        </div>
    <div id="error1"></div>
    <script>
        // TODO: to add more scrs to db
{#        var i = 0;#}
{#        {% for thubnail in {{thumbnails}} %}#}
{#            i ++;#}
{#            var thumbnail_i = thumbnail#}
{#        {% endfor %}#}
            var thumbnailPath = "http://127.0.0.1:8000" + "{{thumbnails.0}}";
            var video = videojs('my-video');
            video.thumbnails({
              0: {
                src: thumbnailPath,
                style: {
                  left: '-60px',
                  width: '120px',
                  height: '68px',
                  clip: 'rect(0, 120px, 68px, 0)'
                }
              },
              10: {
                src: "http://127.0.0.1:8000" + "{{thumbnails.1}}",
{#                style: {#}
{#                  left: '-180px',#}
{#                  clip: 'rect(0, 240px, 68px, 120px)'#}
{#                }#}
              },
              40: {
                scr: "http://127.0.0.1:8000" + "{{thumbnails.2}}",
{#                style: {#}
{#                  left: '-300px',#}
{#                  clip: 'rect(0, 360px, 68px, 240px)'#}
{#                }#}
              },
{#              30: {#}
{#                style: {#}
{#                  left: '-420px',#}
{#                  clip: 'rect(0, 480px, 68px, 360px)'#}
{#                }#}
{#              },#}
{#              40: {#}
{#                style: {#}
{#                  left: '-540px',#}
{#                  clip: 'rect(0, 600px, 68px, 480px)'#}
{#                }#}
{#              }#}
            });
        </script>
 </body>
</html>